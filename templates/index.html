<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game Data</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Game Data</h1>
        <form id="upload-form" class="mt-3">
            <div class="form-group">
                <label for="csv-url">CSV URL:</label>
                <input type="text" class="form-control" id="csv-url" placeholder="Enter CSV URL">
            </div>
            <button type="button" class="btn btn-primary" onclick="uploadData()">Upload Data to DB</button>
        </form>

        <h2 class="mt-5">Query Data</h2>
        <form id="query-form" class="mt-3">
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" id="name" placeholder="Enter game name">
            </div>
            <div class="form-group">
                <label for="appid">AppID:</label>
                <input type="number" class="form-control" id="appid" placeholder="Enter AppID">
            </div>
            <div class="form-group">
                <label for="release_date">Release Date:</label>
                <input type="date" class="form-control" id="release_date">
            </div>
            <div class="form-group">
                <label for="release_date_gt">Release Date Greater Than:</label>
                <input type="date" class="form-control" id="release_date_gt">
            </div>
            <div class="form-group">
                <label for="release_date_lt">Release Date Less Than:</label>
                <input type="date" class="form-control" id="release_date_lt">
            </div>
            <div class="form-group">
                <label for="required_age">Required Age:</label>
                <input type="number" class="form-control" id="required_age" placeholder="Enter required age">
            </div>
            <div class="form-group">
                <label for="price">Price:</label>
                <input type="number" step="0.01" class="form-control" id="price" placeholder="Enter price">
            </div>
            <div class="form-group">
                <label for="price_gt">Price Greater Than:</label>
                <input type="number" step="0.01" class="form-control" id="price_gt" placeholder="Enter price greater than">
            </div>
            <div class="form-group">
                <label for="price_lt">Price Less Than:</label>
                <input type="number" step="0.01" class="form-control" id="price_lt" placeholder="Enter price less than">
            </div>
            <div class="form-group">
                <label for="dlc_count">DLC Count:</label>
                <input type="number" class="form-control" id="dlc_count" placeholder="Enter DLC count">
            </div>
            <div class="form-group">
                <label for="supported_languages">Supported Languages:</label>
                <input type="text" class="form-control" id="supported_languages" placeholder="Enter supported languages">
            </div>
            <div class="form-group">
                <label for="windows">Windows:</label>
                <select class="form-control" id="windows">
                    <option value="">Any</option>
                    <option value="true">True</option>
                    <option value="false">False</option>
                </select>
            </div>
            <div class="form-group">
                <label for="mac">Mac:</label>
                <select class="form-control" id="mac">
                    <option value="">Any</option>
                    <option value="true">True</option>
                    <option value="false">False</option>
                </select>
            </div>
            <div class="form-group">
                <label for="linux">Linux:</label>
                <select class="form-control" id="linux">
                    <option value="">Any</option>
                    <option value="true">True</option>
                    <option value="false">False</option>
                </select>
            </div>
            <div class="form-group">
                <label for="positive">Positive:</label>
                <input type="number" class="form-control" id="positive" placeholder="Enter positive reviews">
            </div>
            <div class="form-group">
                <label for="negative">Negative:</label>
                <input type="number" class="form-control" id="negative" placeholder="Enter negative reviews">
            </div>
            <div class="form-group">
                <label for="score_rank">Score Rank:</label>
                <input type="number" class="form-control" id="score_rank" placeholder="Enter score rank">
            </div>
            <div class="form-group">
                <label for="developers">Developers:</label>
                <input type="text" class="form-control" id="developers" placeholder="Enter developers">
            </div>
            <div class="form-group">
                <label for="publishers">Publishers:</label>
                <input type="text" class="form-control" id="publishers" placeholder="Enter publishers">
            </div>
            <div class="form-group">
                <label for="categories">Categories:</label>
                <input type="text" class="form-control" id="categories" placeholder="Enter categories">
            </div>
            <div class="form-group">
                <label for="genres">Genres:</label>
                <input type="text" class="form-control" id="genres" placeholder="Enter genres">
            </div>
            <div class="form-group">
                <label for="tags">Tags:</label>
                <input type="text" class="form-control" id="tags" placeholder="Enter tags">
            </div>
            <button type="button" class="btn btn-primary" onclick="queryData()">Query Data</button>
        </form>

        <h2 class="mt-5">Query Results</h2>
        <table class="table table-striped" id="query-results-table">
            <thead>
                <tr>
                    <th>AppID</th>
                    <th>Name</th>
                    <th>Release Date</th>
                    <th>Required Age</th>
                    <th>Price</th>
                    <th>DLC Count</th>
                    <th>About The Game</th>
                    <th>Supported Languages</th>
                    <th>Windows</th>
                    <th>Mac</th>
                    <th>Linux</th>
                    <th>Positive</th>
                    <th>Negative</th>
                    <th>Score Rank</th>
                    <th>Developers</th>
                    <th>Publishers</th>
                    <th>Categories</th>
                    <th>Genres</th>
                    <th>Tags</th>
                </tr>
            </thead>
            <tbody id="query-results-body">
            </tbody>
        </table>

        <h2 class="mt-5">Games Table</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>AppID</th>
                    <th>Name</th>
                    <th>Release Date</th>
                    <th>Required Age</th>
                    <th>Price</th>
                    <th>DLC Count</th>
                    <th>About The Game</th>
                    <th>Supported Languages</th>
                    <th>Windows</th>
                    <th>Mac</th>
                    <th>Linux</th>
                    <th>Positive</th>
                    <th>Negative</th>
                    <th>Score Rank</th>
                    <th>Developers</th>
                    <th>Publishers</th>
                    <th>Categories</th>
                    <th>Genres</th>
                    <th>Tags</th>
                </tr>
            </thead>
            <tbody>
                {% for game in games %}
                <tr>
                    <td>{{ game.appid }}</td>
                    <td>{{ game.name }}</td>
                    <td>{{ game.release_date }}</td>
                    <td>{{ game.required_age }}</td>
                    <td>{{ game.price }}</td>
                    <td>{{ game.dlc_count }}</td>
                    <td>{{ game.about_the_game }}</td>
                    <td>{{ game.supported_languages }}</td>
                    <td>{{ game.windows }}</td>
                    <td>{{ game.mac }}</td>
                    <td>{{ game.linux }}</td>
                    <td>{{ game.positive }}</td>
                    <td>{{ game.negative }}</td>
                    <td>{{ game.score_rank }}</td>
                    <td>{{ game.developers }}</td>
                    <td>{{ game.publishers }}</td>
                    <td>{{ game.categories }}</td>
                    <td>{{ game.genres }}</td>
                    <td>{{ game.tags }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        function uploadData() {
            const csvUrl = document.getElementById('csv-url').value;
            fetch('/upload', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa('username:password')
                },
                body: JSON.stringify({ csv_url: csvUrl })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert('Success: ' + data.message);
                    location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        }

        function queryData() {
            const queryParams = {};
            const fields = [
                'name', 'appid', 'release_date', 'release_date_gt', 'release_date_lt',
                'required_age', 'price', 'price_gt', 'price_lt', 'dlc_count',
                'supported_languages', 'windows', 'mac', 'linux', 'positive',
                'negative', 'score_rank', 'developers', 'publishers', 'categories',
                'genres', 'tags'
            ];
            fields.forEach(field => {
                const value = document.getElementById(field).value;
                if (value) {
                    queryParams[field] = value;
                }
            });

            fetch('/query?' + new URLSearchParams(queryParams), {
                method: 'GET',
                headers: {
                    'Authorization': 'Basic ' + btoa('username:password')
                }
            })
            .then(response => response.json())
            .then(data => {
                const queryResultsBody = document.getElementById('query-results-body');
                queryResultsBody.innerHTML = '';
                data.forEach(game => {
                    const row = document.createElement('tr');
                    Object.keys(game).forEach(key => {
                        const cell = document.createElement('td');
                        cell.textContent = game[key];
                        row.appendChild(cell);
                    });
                    queryResultsBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
